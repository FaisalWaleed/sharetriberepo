[{"name":"sql.active_record","payload":{"sql":"SELECT  `communities`.* FROM `communities` WHERE `communities`.`domain` = 'commerce.codingstack.com'  ORDER BY `communities`.`id` ASC LIMIT 1","name":"Community Load","connection_id":18564460,"statement_name":null,"binds":[],"line":609,"filename":"/root/sharetriberepo/app/models/community.rb","method":"find_by_identifier"},"time":"2016-05-16T11:29:02.708+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.708+00:00","children":[],"duration":0.77235},{"name":"sql.active_record","payload":{"sql":"SELECT COUNT(*) FROM `communities`","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":308,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"perform_redirect"},"time":"2016-05-16T11:29:02.711+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.712+00:00","children":[],"duration":0.5120669999999999},{"name":"sql.active_record","payload":{"sql":"SELECT  `sessions`.* FROM `sessions` WHERE `sessions`.`session_id` = 'cf48c15ff987895945402af6bf948d38'  ORDER BY `sessions`.`id` ASC LIMIT 1","name":"ActiveRecord::SessionStore::Session Load","connection_id":18564460,"statement_name":null,"binds":[],"line":173,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_logged_in_user"},"time":"2016-05-16T11:29:02.715+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.716+00:00","children":[],"duration":0.935147},{"name":"sql.active_record","payload":{"sql":"SELECT  `people`.* FROM `people` WHERE `people`.`id` = '6IXSNFhhCRFcUfrUXrknbQ'  ORDER BY `people`.`id` ASC LIMIT 1","name":"Person Load","connection_id":18564460,"statement_name":null,"binds":[],"line":173,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_logged_in_user"},"time":"2016-05-16T11:29:02.719+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.719+00:00","children":[],"duration":0.481924},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_memberships`.* FROM `community_memberships` WHERE `community_memberships`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ' AND `community_memberships`.`community_id` = 1 AND `community_memberships`.`status` = 'accepted'  ORDER BY `community_memberships`.`id` ASC LIMIT 1","name":"CommunityMembership Load","connection_id":18564460,"statement_name":null,"binds":[],"line":378,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_community_membership"},"time":"2016-05-16T11:29:02.722+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.722+00:00","children":[],"duration":0.443952},{"name":"sql.active_record","payload":{"sql":"BEGIN","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":381,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_community_membership"},"time":"2016-05-16T11:29:02.729+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.729+00:00","children":[],"duration":0.579263},{"name":"sql.active_record","payload":{"sql":"INSERT INTO `delayed_jobs` (`handler`, `priority`, `queue`, `run_at`, `created_at`, `updated_at`) VALUES ('--- !ruby/struct:PageLoadedJob\\ncommunity_membership_id: 5\\nhost: commerce.codingstack.com\\n', 5, 'default', '2016-05-16 11:29:02', '2016-05-16 11:29:02', '2016-05-16 11:29:02')","name":"SQL","connection_id":18564460,"statement_name":null,"binds":[],"line":381,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_community_membership"},"time":"2016-05-16T11:29:02.732+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.733+00:00","children":[],"duration":0.643639},{"name":"sql.active_record","payload":{"sql":"COMMIT","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":381,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"fetch_community_membership"},"time":"2016-05-16T11:29:02.735+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.736+00:00","children":[],"duration":1.046421},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","name":"CommunityCustomization Load","connection_id":18564460,"statement_name":null,"binds":[],"line":277,"filename":"/root/sharetriberepo/app/models/community.rb","method":"name"},"time":"2016-05-16T11:29:02.742+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.742+00:00","children":[],"duration":0.620001},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","name":"CommunityCustomization Load","connection_id":18564460,"statement_name":null,"binds":[],"line":119,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"block in set_locale"},"time":"2016-05-16T11:29:02.745+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.745+00:00","children":[],"duration":0.452716},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_memberships`.* FROM `community_memberships` WHERE `community_memberships`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ' LIMIT 1","name":"CommunityMembership Load","connection_id":18564460,"statement_name":null,"binds":[],"line":435,"filename":"/root/sharetriberepo/app/models/person.rb","method":"is_marketplace_admin?"},"time":"2016-05-16T11:29:02.748+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.748+00:00","children":[],"duration":0.500803},{"name":"sql.active_record","payload":{"sql":"SELECT  `payment_settings`.* FROM `payment_settings` WHERE `payment_settings`.`community_id` = 1 AND `payment_settings`.`active` = 1  ORDER BY `payment_settings`.`id` ASC LIMIT 1","name":"PaymentSettings Load","connection_id":18564460,"statement_name":null,"binds":[],"line":54,"filename":"/root/sharetriberepo/app/services/transaction_service/store/payment_settings.rb","method":"get_active"},"time":"2016-05-16T11:29:02.751+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.751+00:00","children":[],"duration":0.47552},{"name":"sql.active_record","payload":{"sql":"SELECT COUNT(*) AS count_all, priority AS priority FROM `delayed_jobs` WHERE (attempts \u003c 3 AND run_at \u003c '2016-05-16 11:29:02.753268') GROUP BY `delayed_jobs`.`priority`","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":33,"filename":"/root/sharetriberepo/app/services/monitoring_service/monitoring.rb","method":"report_queue_size"},"time":"2016-05-16T11:29:02.754+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.755+00:00","children":[],"duration":0.9097470000000001},{"name":"sql.active_record","payload":{"sql":"SELECT  `communities`.* FROM `communities` INNER JOIN `community_memberships` ON `communities`.`id` = `community_memberships`.`community_id` WHERE `community_memberships`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ' AND (community_memberships.status= 'accepted') LIMIT 1","name":"Community Load","connection_id":18564460,"statement_name":null,"binds":[],"line":213,"filename":"/root/sharetriberepo/app/controllers/application_controller.rb","method":"ensure_user_belongs_to_community"},"time":"2016-05-16T11:29:02.757+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.758+00:00","children":[],"duration":0.469712},{"name":"sql.active_record","payload":{"sql":"SELECT `participations`.`conversation_id` FROM `participations` WHERE `participations`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ'","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":122,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_inbox_data"},"time":"2016-05-16T11:29:02.763+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.764+00:00","children":[],"duration":0.573403},{"name":"sql.active_record","payload":{"sql":"\n          SELECT\n            transactions.id AS transaction_id,\n            conversations.id AS conversation_id,\n\n            GREATEST(COALESCE(transactions.last_transition_at, 0),\n              COALESCE(conversations.last_message_at, 0))     AS last_activity_at,\n\n            transactions.last_transition_at                   AS last_transition_at,\n            transactions.current_state                        AS last_transition_to_state,\n            transactions.payment_gateway                      AS payment_gateway,\n            conversations.last_message_at                     AS last_message_at,\n\n            listings.id                                       AS listing_id,\n            listings.title                                    AS listing_title,\n            listings.deleted                                  AS listing_deleted,\n\n            payments.id                                       AS payment_id,\n\n            listings.author_id                                AS author_id,\n            current_participation.person_id                   AS current_id,\n            other_participation.person_id                     AS other_id,\n\n            current_participation.is_read                     AS current_is_read,\n            current_participation.is_starter                  AS current_is_starter,\n\n            transactions.community_id                         AS community_id,\n\n            # Requires actions\n            (\n             ((transactions.current_state = 'pending' OR transactions.current_state = 'preauthorized') AND current_participation.is_starter = FALSE) OR\n             ((transactions.current_state = 'accepted' OR transactions.current_state = 'paid')         AND current_participation.is_starter = TRUE)\n            )                                                 AS current_action_required,\n\n            # Waiting feedback\n            ((transactions.current_state = 'confirmed') AND (\n             (current_participation.is_starter = TRUE AND transactions.starter_skipped_feedback = FALSE AND testimonials.id IS NULL) OR\n             (current_participation.is_starter = FALSE AND transactions.author_skipped_feedback = FALSE AND testimonials.id IS NULL)\n            ))                                                AS waiting_feedback\n          FROM conversations\n\n          LEFT JOIN transactions      ON transactions.conversation_id = conversations.id\n          LEFT JOIN listings          ON transactions.listing_id = listings.id\n          LEFT JOIN payments          ON payments.transaction_id = transactions.id\n          LEFT JOIN testimonials      ON (testimonials.transaction_id = transactions.id AND testimonials.author_id = '6IXSNFhhCRFcUfrUXrknbQ')\n          LEFT JOIN participations    AS current_participation ON (current_participation.conversation_id = conversations.id AND current_participation.person_id = '6IXSNFhhCRFcUfrUXrknbQ')\n          LEFT JOIN participations    AS other_participation ON (other_participation.conversation_id = conversations.id AND other_participation.person_id != '6IXSNFhhCRFcUfrUXrknbQ')\n\n          # Where person and community\n          WHERE conversations.community_id = 1\n          AND conversations.id IN (1)\n\n          # Ignore initiated and deleted\n          AND (\n            transactions.id IS NULL\n            OR (transactions.current_state != 'initiated'\n                AND transactions.deleted = 0)\n          )\n\n          # Order by 'last_activity_at', that is last message or last transition\n          ORDER BY last_activity_at DESC\n\n          # Pagination\n          LIMIT 30 OFFSET 0\n        ","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":134,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_inbox_data"},"time":"2016-05-16T11:29:02.765+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.767+00:00","children":[],"duration":1.3962359999999998},{"name":"sql.active_record","payload":{"sql":"SELECT `people`.* FROM `people` WHERE `people`.`id` IN ('6IXSNFhhCRFcUfrUXrknbQ', 'Mv7DsWSUM9EAycvAicHkBw')","name":"Person Load","connection_id":18564460,"statement_name":null,"binds":[],"line":65,"filename":"/root/sharetriberepo/app/services/marketplace_service/person.rb","method":"people"},"time":"2016-05-16T11:29:02.769+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.770+00:00","children":[],"duration":0.6628959999999999},{"name":"sql.active_record","payload":{"sql":"\n          SELECT id, conversation_id, content, created_at FROM messages WHERE conversation_id in (1)\n        ","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":119,"filename":"/root/sharetriberepo/app/services/marketplace_service/conversation.rb","method":"latest_messages_for_conversations"},"time":"2016-05-16T11:29:02.773+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.773+00:00","children":[],"duration":0.569925},{"name":"sql.active_record","payload":{"sql":"SELECT `transaction_transitions`.* FROM `transaction_transitions` WHERE `transaction_transitions`.`transaction_id` = 2","name":"TransactionTransition Load","connection_id":18564460,"statement_name":null,"binds":[],"line":211,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"extend_transaction"},"time":"2016-05-16T11:29:02.775+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.775+00:00","children":[],"duration":0.383371},{"name":"sql.active_record","payload":{"sql":"SELECT `participations`.`conversation_id` FROM `participations` WHERE `participations`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ'","binds":[[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"person_id","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"6IXSNFhhCRFcUfrUXrknbQ"]],"name":"CACHE","connection_id":18564460,"line":175,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_inbox_data_count"},"time":"2016-05-16T11:29:02.781+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.782+00:00","children":[],"duration":0.403709},{"name":"sql.active_record","payload":{"sql":"\n          SELECT COUNT(conversations.id)\n          FROM conversations\n\n          LEFT JOIN transactions      ON transactions.conversation_id = conversations.id\n\n          # Where person and community\n          WHERE conversations.community_id = 1\n          AND conversations.id IN (1)\n\n          # Ignore initiated and deleted\n          AND (\n            transactions.id IS NULL\n            OR (transactions.current_state != 'initiated'\n                AND transactions.deleted = 0)\n          )\n        ","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":185,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_inbox_data_count"},"time":"2016-05-16T11:29:02.783+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.784+00:00","children":[],"duration":0.815802},{"name":"sql.active_record","payload":{"sql":"SELECT  `communities`.* FROM `communities` WHERE `communities`.`id` = 1 LIMIT 1","name":"Community Load","connection_id":18564460,"statement_name":null,"binds":[],"line":26,"filename":"/root/sharetriberepo/app/services/marketplace_service/community.rb","method":"payment_type"},"time":"2016-05-16T11:29:02.787+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.788+00:00","children":[],"duration":0.5165289999999999},{"name":"sql.active_record","payload":{"sql":"SELECT  `payment_settings`.* FROM `payment_settings` WHERE `payment_settings`.`community_id` = 1 AND `payment_settings`.`active` = 1  ORDER BY `payment_settings`.`id` ASC LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":false,"default":null,"default_function":null},1],[{"strict":true,"collation":null,"extra":"","name":"active","cast_type":{"precision":null,"scale":null,"limit":1},"sql_type":"tinyint(1)","null":false,"default":null,"default_function":null},true]],"name":"CACHE","connection_id":18564460,"line":54,"filename":"/root/sharetriberepo/app/services/transaction_service/store/payment_settings.rb","method":"get_active"},"time":"2016-05-16T11:29:02.790+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.791+00:00","children":[],"duration":0.36298800000000003},{"name":"sql.active_record","payload":{"sql":"SELECT  `payment_gateways`.* FROM `payment_gateways` WHERE `payment_gateways`.`community_id` = 1 LIMIT 1","name":"PaymentGateway Load","connection_id":18564460,"statement_name":null,"binds":[],"line":30,"filename":"/root/sharetriberepo/app/services/marketplace_service/community.rb","method":"block in payment_type"},"time":"2016-05-16T11:29:02.793+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.794+00:00","children":[],"duration":0.5208119999999999},{"name":"sql.active_record","payload":{"sql":"SELECT  `payment_gateways`.* FROM `payment_gateways` WHERE `payment_gateways`.`community_id` = 1 LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":true,"default":null,"default_function":null},1]],"name":"CACHE","connection_id":18564460,"line":528,"filename":"/root/sharetriberepo/app/models/community.rb","method":"payments_in_use?"},"time":"2016-05-16T11:29:02.795+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.796+00:00","children":[],"duration":0.281151},{"name":"render_template.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/inboxes/show.haml","layout":"layouts/application"},"time":"2016-05-16T11:29:02.806+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.818+00:00","children":[],"duration":12.33113},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_kissmetrics.haml"},"time":"2016-05-16T11:29:02.829+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.830+00:00","children":[],"duration":0.26555300000000004},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_google_analytics_script.haml"},"time":"2016-05-16T11:29:02.830+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.831+00:00","children":[],"duration":0.23680500000000002},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":true,"default":null,"default_function":null},1],[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"locale","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"en"]],"name":"CACHE","connection_id":18564460,"line":277,"filename":"/root/sharetriberepo/app/models/community.rb","method":"name"},"time":"2016-05-16T11:29:02.833+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.834+00:00","children":[],"duration":0.5745220000000001},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":true,"default":null,"default_function":null},1],[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"locale","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"en"]],"name":"CACHE","connection_id":18564460,"line":277,"filename":"/root/sharetriberepo/app/models/community.rb","method":"name"},"time":"2016-05-16T11:29:02.838+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.839+00:00","children":[],"duration":0.6499290000000001},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":true,"default":null,"default_function":null},1],[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"locale","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"en"]],"name":"CACHE","connection_id":18564460,"line":277,"filename":"/root/sharetriberepo/app/models/community.rb","method":"name"},"time":"2016-05-16T11:29:02.845+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.846+00:00","children":[],"duration":0.622048},{"name":"sql.active_record","payload":{"sql":"SELECT  `community_customizations`.* FROM `community_customizations` WHERE `community_customizations`.`community_id` = 1 AND `community_customizations`.`locale` = 'en'  ORDER BY `community_customizations`.`id` ASC LIMIT 1","binds":[[{"strict":true,"collation":null,"extra":"","name":"community_id","cast_type":{"precision":null,"scale":null,"limit":4,"range":"-2147483648...2147483648"},"sql_type":"int(11)","null":true,"default":null,"default_function":null},1],[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"locale","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"en"]],"name":"CACHE","connection_id":18564460,"line":277,"filename":"/root/sharetriberepo/app/models/community.rb","method":"name"},"time":"2016-05-16T11:29:02.850+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.851+00:00","children":[],"duration":0.5366099999999999},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_marketplace_head.haml"},"time":"2016-05-16T11:29:02.832+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.859+00:00","children":[],"duration":27.380372},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_head.haml"},"time":"2016-05-16T11:29:02.829+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.860+00:00","children":[],"duration":30.831066},{"name":"sql.active_record","payload":{"sql":"SELECT `participations`.`conversation_id` FROM `participations` WHERE `participations`.`person_id` = '6IXSNFhhCRFcUfrUXrknbQ'","binds":[[{"strict":true,"collation":"utf8_unicode_ci","extra":"","name":"person_id","cast_type":{"precision":null,"scale":null,"limit":255},"sql_type":"varchar(255)","null":true,"default":null,"default_function":null},"6IXSNFhhCRFcUfrUXrknbQ"]],"name":"CACHE","connection_id":18564460,"line":108,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_notification_count"},"time":"2016-05-16T11:29:02.866+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.867+00:00","children":[],"duration":0.886901},{"name":"sql.active_record","payload":{"sql":"\n          SELECT COUNT(conversations.id) FROM conversations\n\n          LEFT JOIN transactions      ON transactions.conversation_id = conversations.id\n          LEFT JOIN listings          ON transactions.listing_id = listings.id\n          LEFT JOIN testimonials      ON (testimonials.transaction_id = transactions.id AND testimonials.author_id = '6IXSNFhhCRFcUfrUXrknbQ')\n          LEFT JOIN participations    ON (participations.conversation_id = conversations.id AND participations.person_id = '6IXSNFhhCRFcUfrUXrknbQ')\n\n          # Where person and community\n          WHERE conversations.community_id = 1\n          AND conversations.id IN (1)\n\n          # Ignore initiated and deleted\n          AND (\n            transactions.id IS NULL\n            OR (transactions.current_state != 'initiated'\n                AND transactions.deleted = 0)\n          )\n\n          # This is a bit complicated logic that is now moved from app to SQL.\n          # I'm not complelety sure if it's a good or bad. However, since this query is called once per every page\n          # load, I think it's ok to make some performance optimizations and have this logic in SQL.\n          AND (\n            # Is read?\n            (participations.is_read = FALSE) OR\n\n            # Requires actions\n            ((transactions.current_state = 'pending' OR transactions.current_state = 'preauthorized') AND participations.is_starter = FALSE) OR\n            ((transactions.current_state = 'accepted' OR transactions.current_state = 'paid')         AND participations.is_starter = TRUE) OR\n\n            # Waiting feedback\n            ((transactions.current_state = 'confirmed') AND (\n              (participations.is_starter = TRUE AND transactions.starter_skipped_feedback = FALSE AND testimonials.id IS NULL) OR\n              (participations.is_starter = FALSE AND transactions.author_skipped_feedback = FALSE AND testimonials.id IS NULL)\n            ))\n          )\n        ","name":null,"connection_id":18564460,"statement_name":null,"binds":[],"line":118,"filename":"/root/sharetriberepo/app/services/marketplace_service/inbox.rb","method":"query_notification_count"},"time":"2016-05-16T11:29:02.871+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.872+00:00","children":[],"duration":1.15574},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_header_anchors.haml"},"time":"2016-05-16T11:29:02.877+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.882+00:00","children":[],"duration":5.253916},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_header_user_menu.haml"},"time":"2016-05-16T11:29:02.883+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.893+00:00","children":[],"duration":10.259763999999999},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_header_right_visible_tablet.haml"},"time":"2016-05-16T11:29:02.896+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.898+00:00","children":[],"duration":2.324797},{"name":"sql.active_record","payload":{"sql":"SELECT `menu_links`.* FROM `menu_links` WHERE `menu_links`.`community_id` = 1  ORDER BY sort_priority","name":"MenuLink Load","connection_id":18564460,"statement_name":null,"binds":[],"line":24,"filename":"/root/sharetriberepo/app/views/layouts/_header_menu.haml","method":"_app_views_layouts__header_menu_haml___88728714528797189_45903560"},"time":"2016-05-16T11:29:02.909+00:00","transaction_id":"5a978a9093b5214652de","end":"2016-05-16T11:29:02.912+00:00","children":[],"duration":2.343789},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_header_menu.haml"},"time":"2016-05-16T11:29:02.902+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.916+00:00","children":[],"duration":13.66099},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_global_header.haml"},"time":"2016-05-16T11:29:02.861+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.917+00:00","children":[],"duration":56.13134},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_notifications.haml"},"time":"2016-05-16T11:29:02.920+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.920+00:00","children":[],"duration":0.327646},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_facebook_sdk.haml"},"time":"2016-05-16T11:29:02.922+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.922+00:00","children":[],"duration":0.384963},{"name":"render_partial.action_view","payload":{"identifier":"/root/sharetriberepo/app/views/layouts/_noscript.haml"},"time":"2016-05-16T11:29:02.924+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.925+00:00","children":[],"duration":1.259471},{"name":"process_action.action_controller","payload":{"controller":"InboxesController","action":"show","params":{"controller":"inboxes","action":"show","locale":"en","person_id":"user4"},"format":"html","method":"GET","path":"/en/user4/inbox","status":200,"view_runtime":127.76910004154117,"db_runtime":8.053468,"host":"commerce.codingstack.com","community_id":1,"current_user_id":"6IXSNFhhCRFcUfrUXrknbQ","request_uuid":"7e704614-ce78-4c42-a578-7558d538098b"},"time":"2016-05-16T11:29:02.706+00:00","transaction_id":"3a6622430830abae8853","end":"2016-05-16T11:29:02.926+00:00","children":[],"duration":220.160029}]